<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${transaction.id} != null ? 'Chỉnh sửa giao dịch' : 'Thêm giao dịch'">Giao dịch</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<style>
    .main-navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 2px 20px rgba(0,0,0,0.1); padding: 15px 30px; position: sticky; top: 0; z-index: 1000; }
    .navbar-brand { color: white; font-size: 20px; font-weight: 600; text-decoration: none; display: flex; align-items: center; }
    .navbar-brand:hover { color: white; }
    .navbar-brand i { margin-right: 10px; }
    .navbar-nav { display: flex; flex-direction: row; flex-wrap: nowrap; align-items: center; gap: 20px; list-style: none; margin: 0; padding: 0; white-space: nowrap; }
    .nav-item { list-style: none; }
    .nav-link { color: rgba(255,255,255,0.9); padding: 10px 15px; border-radius: 5px; text-decoration: none; transition: .3s; display: flex; align-items: center; }
    .nav-link:hover { background: rgba(255,255,255,0.1); color: white; }
    .nav-link.active { background: rgba(255,255,255,0.15); color: white; }
    .nav-link i { margin-right: 8px; }
</style>

<nav class="main-navbar">
    <div class="container d-flex justify-content-between align-items-center">
        <a th:href="@{'/finance/categories/' + ${category.id}}" class="navbar-brand">
            <i class="fas fa-tags"></i>
            <span th:text="${category.name}">Danh mục</span>
        </a>
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="/finance"><i class="fas fa-tachometer-alt"></i>Dashboard</a></li>
            <li class="nav-item"><a class="nav-link active" href="/finance/categories"><i class="fas fa-tags"></i>Danh mục</a></li>
            <li class="nav-item"><a class="nav-link" th:href="@{'/finance/categories/' + ${category.id}}"><i class="fas fa-list"></i>Chi tiết</a></li>
        </ul>
    </div>
</nav>

<div class="container mt-4">
    <div class="card">
        <div class="card-header">
            <i class="fas fa-receipt me-2"></i>
            <span th:text="${transaction.id} != null ? 'Chỉnh sửa giao dịch' : 'Thêm giao dịch mới'">Tiêu đề</span>
        </div>
        <div class="card-body">
            <form th:object="${transaction}"
                  th:action="${transaction.id} != null ? @{'/finance/categories/' + ${category.id} + '/transactions/edit/' + ${transaction.id}} : @{'/finance/categories/' + ${category.id} + '/transactions/add'}"
                  method="post">

                <div class="row">
                    <div class="col-md-8 mb-3">
                        <label class="form-label" th:text="${category.type.name() == 'EXPENSE'} ? 'Tên khoản chi' : 'Tiêu đề giao dịch'">Tiêu đề giao dịch</label>
                        <input type="text" class="form-control" th:field="*{title}" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label" th:text="${category.type.name() == 'EXPENSE'} ? 'Số tiền chi' : 'Số tiền'">Số tiền</label>
                        <input type="number" step="0.01" min="0" class="form-control" th:field="*{amount}" required>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Mô tả</label>
                    <textarea class="form-control" rows="3" th:field="*{description}"></textarea>
                </div>

                <!-- Các trường bổ sung chỉ hiện nếu KHÔNG phải khoản chi -->
                <div class="row" th:if="${category.type.name() != 'EXPENSE'}">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Ngày giao dịch</label>
                        <input type="date" class="form-control" th:field="*{transactionDate}" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Phương thức thanh toán</label>
                        <select class="form-select" th:field="*{paymentMethod}">
                            <option value="">Chọn phương thức</option>
                            <option th:each="m : ${paymentMethods}" th:value="${m}" th:text="${m.displayName}"></option>
                        </select>
                    </div>
                </div>

                <div class="row" th:if="${category.type.name() != 'EXPENSE'}">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Số chứng từ</label>
                        <input type="text" class="form-control" th:field="*{receiptNumber}">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Ghi chú</label>
                        <input type="text" class="form-control" th:field="*{notes}">
                    </div>
                </div>

                <div class="mb-3" th:if="${category.type.name() != 'EXPENSE'}">
                    <label class="form-label">Người nộp (theo Person)</label>
                    <select class="form-select" name="personId">
                        <option value="">Chọn người nộp</option>
                        <option th:each="p : ${persons}"
                                th:value="${p.id}"
                                th:selected="${transaction.contributor != null} ? ${p.id} == ${transaction.contributor.id} : false"
                                th:text="${p.name} + ' - ' + (${p.phone} != null ? ${p.phone} : '')">
                        </option>
                    </select>
                    <div class="form-text">Tên người nộp sẽ hiển thị theo Person đã chọn.</div>
                </div>

                <div class="d-flex justify-content-between">
                    <a th:href="@{'/finance/categories/' + ${category.id}}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left me-1"></i>Quay lại
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i>Lưu
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
